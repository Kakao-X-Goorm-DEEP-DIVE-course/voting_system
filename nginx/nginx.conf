# nginx.conf

# Nginx 글로벌 설정
user  nginx;
worker_processes  auto;
pid /run/nginx.pid;

events {
    worker_connections 1024;
}

# http 블록 안에 server 블록을 넣습니다.
http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

	server {
	    listen 80;

	    # post-service로 프록시 (경로 재작성 제거)
	    location /post/ {
		proxy_pass http://post-service:8000/post/;  # /post/ 경로 그대로 전달
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_set_header X-Forwarded-Proto $scheme;
	    }

	    # vote-service로 프록시 (경로 재작성 제거)
	    location /vote/ {
		proxy_pass http://vote-service:8000/vote/;  # /vote/ 경로 그대로 전달
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_set_header X-Forwarded-Proto $scheme;
	    }
	}

    sendfile        on;
    keepalive_timeout  65;
    include /etc/nginx/conf.d/*.conf;
}
